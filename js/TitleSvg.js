// 博客标题 SVG 描边动画 - "我不想当ai"
// JS 控制动画播放时机，确保从头开始

document.addEventListener('DOMContentLoaded', function() {
    const navbarBrand = document.querySelector('.navbar-brand');
    
    if (!navbarBrand) return;
    if (navbarBrand.querySelector('.title-svg')) return;
    
    // 配置
    const STROKE_DURATION = 2300;
    const SESSION_KEY = 'titleAnimationPlayed';
    
    // 检查是否已播放过
    const hasPlayed = sessionStorage.getItem(SESSION_KEY);
    
    // 插入 SVG（默认暂停状态）
    navbarBrand.innerHTML = `
        <svg class="title-svg" viewBox="0 0 303.409 59.652" xmlns="http://www.w3.org/2000/svg" aria-label="我不想当ai" role="img">
            <path class="title-path${hasPlayed ? ' no-animation' : ''}" d="M 48.432 24.32 L 54.448 24.32 C 56.304 24.32 57.264 23.296 57.264 21.44 C 57.264 19.584 56.304 18.624 54.448 18.624 L 48.176 18.624 L 39.088 18.624 C 38.64 13.888 38.448 8.896 38.384 3.776 C 38.384 1.664 37.36 0.512 35.248 0.512 C 33.136 0.512 32.112 1.6 32.176 3.712 C 32.304 8.768 32.496 13.824 32.944 18.624 L 19.376 18.624 L 19.376 8.448 C 21.744 8 24.048 7.424 26.224 6.848 C 28.848 6.016 29.104 4.672 27.376 2.56 C 26.288 1.216 25.456 0.704 23.792 1.216 C 18.48 3.008 11.056 4.608 3.952 5.76 C 1.776 6.08 0.752 6.976 1.52 9.088 C 2.096 10.752 3.056 11.2 4.784 11.008 C 7.6 10.624 10.48 10.176 13.36 9.664 L 13.36 18.624 L 3.248 18.624 C 1.392 18.624 0.432 19.584 0.432 21.44 C 0.432 23.296 1.392 24.32 3.248 24.32 L 13.36 24.32 L 13.36 34.496 C 9.264 35.264 5.488 35.968 2.224 36.544 C 0.048 36.928 -0.336 38.144 0.24 40.256 C 0.752 42.24 2.032 43.008 4.016 42.56 L 13.36 40.512 L 13.36 51.968 C 13.36 52.992 12.976 53.312 11.888 53.376 C 11.312 53.44 10.032 53.44 8.368 53.44 C 5.552 53.376 3.504 54.336 4.464 56.96 C 5.104 58.752 7.152 59.392 9.072 59.392 C 12.336 59.328 14.704 59.008 16.368 58.24 C 18.672 57.28 19.376 55.552 19.376 51.968 L 19.376 39.168 L 28.144 37.248 C 29.744 36.864 30.512 35.776 30.384 34.112 C 30.256 32.192 29.168 31.36 27.248 31.744 L 19.376 33.28 L 19.376 24.32 L 33.52 24.32 C 34.288 30.976 35.44 37.184 36.912 42.432 C 33.392 45.504 29.552 48.256 25.584 50.496 C 23.28 51.712 22.768 53.056 24.432 55.04 C 25.712 56.64 27.12 56.64 28.912 55.68 C 32.432 53.568 35.76 51.136 38.896 48.448 C 41.776 55.36 45.488 59.648 50.416 59.648 C 54.832 59.648 56.944 57.472 58.096 50.112 C 58.288 48.512 58.16 45.376 56.816 44.48 C 54.32 42.816 53.296 46.528 53.04 49.536 C 52.592 52.224 51.952 53.44 50.992 53.44 C 48.368 53.44 45.872 49.856 43.888 43.84 C 47.408 40.192 50.48 36.16 53.104 31.872 C 54.128 30.08 53.68 28.736 51.824 27.968 C 50.16 27.264 48.88 27.712 47.984 29.248 C 46.256 32.064 44.272 34.816 42.032 37.376 C 41.072 33.472 40.304 29.12 39.664 24.32 L 48.432 24.32 Z M 217.2 50.688 L 199.216 50.688 C 197.232 50.688 196.208 51.712 196.208 53.696 C 196.208 55.68 197.232 56.704 199.216 56.704 L 217.264 56.704 L 240.496 56.704 C 242.992 56.704 244.656 55.04 244.656 52.544 L 244.656 26.56 C 244.656 24.064 242.992 22.4 240.496 22.4 L 223.984 22.4 L 223.984 3.2 C 223.984 1.088 222.896 0 220.784 0 C 218.672 0 217.52 1.088 217.52 3.2 L 217.52 22.4 L 200.496 22.4 C 198.512 22.4 197.488 23.424 197.488 25.408 C 197.488 27.392 198.512 28.48 200.496 28.48 L 236.336 28.48 C 237.616 28.48 238.256 29.12 238.256 30.4 L 238.256 36.288 L 202.48 36.288 C 200.56 36.288 199.6 37.248 199.6 39.168 C 199.6 41.088 200.56 42.112 202.48 42.112 L 238.256 42.112 L 238.256 48.768 C 238.256 50.048 237.616 50.688 236.336 50.688 L 217.2 50.688 Z M 95.984 38.208 L 95.984 17.152 C 97.52 14.976 98.928 12.8 100.208 10.56 L 117.168 10.56 C 119.216 10.56 120.24 9.536 120.24 7.488 C 120.24 5.44 119.216 4.416 117.168 4.416 L 92.784 4.416 L 68.4 4.416 C 66.352 4.416 65.328 5.44 65.328 7.488 C 65.328 9.536 66.352 10.56 68.4 10.56 L 92.336 10.56 C 86.832 19.968 77.808 29.376 67.248 35.52 C 64.88 36.736 64.24 38.272 65.84 40.384 C 67.12 42.112 68.656 42.24 70.576 41.216 C 77.68 37.056 84.016 31.552 89.52 25.472 L 89.52 56.064 C 89.52 58.176 90.672 59.264 92.784 59.264 C 94.896 59.264 95.984 58.176 95.984 56.064 L 95.984 38.208 Z M 139.504 30.464 L 139.504 35.136 C 139.504 36.992 140.528 37.952 142.384 37.952 C 144.24 37.952 145.2 36.992 145.2 35.136 L 145.2 23.232 C 146.864 24.768 148.784 26.496 150.384 27.968 C 151.984 29.568 152.88 29.12 154.096 27.264 C 155.12 25.728 155.376 24.96 153.904 23.872 C 151.344 21.952 146.992 18.816 145.2 17.664 L 145.2 14.592 L 152.112 14.592 C 153.84 14.592 154.736 13.696 154.736 11.968 C 154.736 10.24 153.84 9.344 152.112 9.344 L 145.2 9.344 L 145.2 2.944 C 145.2 1.088 144.24 0.128 142.384 0.128 C 140.528 0.128 139.504 1.088 139.504 2.944 L 139.504 9.344 L 133.936 9.344 L 130.992 9.344 C 129.264 9.344 128.368 10.24 128.368 11.968 C 128.368 13.696 129.264 14.592 130.992 14.592 L 138.544 14.592 C 136.24 19.648 132.848 24.768 129.2 28.16 C 127.472 29.632 127.408 30.72 128.944 32.384 C 130.288 33.856 131.312 33.856 132.784 32.512 C 135.152 29.952 137.456 26.624 139.504 22.976 L 139.504 30.464 Z M 284.72 38.144 L 284.72 32.832 C 284.72 23.424 280.688 17.92 271.92 17.92 C 267.312 17.92 263.152 19.456 259.824 21.312 C 258.224 22.208 258.16 23.296 259.056 24.896 C 260.016 26.624 261.296 27.008 263.024 26.048 C 265.392 24.832 267.952 23.936 270.64 23.936 C 275.824 23.936 277.296 27.52 277.36 31.552 C 262.704 33.152 256.304 37.056 256.304 44.672 C 256.304 50.88 260.592 54.912 266.672 54.912 C 270.896 54.912 274.672 52.736 277.872 49.984 L 278.128 49.984 L 278.32 51.328 C 278.576 53.12 279.728 54.016 281.584 54.016 C 283.568 54.016 284.72 52.992 284.72 51.008 L 284.72 43.456 L 284.72 38.144 Z M 182.704 20.288 L 182.704 7.488 C 182.704 4.992 181.04 3.328 178.544 3.328 L 161.584 3.328 C 159.088 3.328 157.424 4.992 157.424 7.488 L 157.424 33.088 C 157.424 35.584 159.088 37.248 161.584 37.248 L 170.032 37.248 L 178.544 37.248 C 181.04 37.248 182.704 35.584 182.704 33.088 L 182.704 20.288 Z M 148.336 45.824 L 148.336 43.968 C 148.336 41.984 147.376 41.024 145.392 41.024 C 143.408 41.024 142.384 41.984 142.384 43.968 L 142.384 45.888 L 142.384 50.688 C 142.384 56.384 144.432 58.048 152.112 58.048 L 164.592 58.048 C 169.648 58.048 171.76 56.704 172.72 51.712 C 172.976 49.984 172.784 47.168 171.12 46.528 C 168.688 45.504 167.472 48.64 167.088 51.264 C 166.576 52.352 165.68 52.608 164.144 52.608 L 152.56 52.608 C 148.912 52.608 148.336 52.352 148.336 50.56 L 148.336 45.824 Z M 302.512 36.416 L 302.512 22.4 C 302.512 19.968 301.296 18.752 298.864 18.752 C 296.432 18.752 295.152 19.968 295.152 22.4 L 295.152 52.416 C 295.152 53.376 295.792 54.016 296.752 54.016 L 298.8 54.016 L 298.992 54.016 C 301.104 54.016 302.512 52.608 302.512 50.496 L 302.512 36.416 Z M 112.496 28.928 C 109.232 26.368 105.776 23.808 102.64 21.632 C 101.296 20.672 100.144 20.864 98.864 21.952 C 97.072 23.424 97.008 24.832 98.864 26.176 C 101.808 28.352 104.944 30.848 107.888 33.344 C 110.704 35.648 113.264 37.952 115.248 40.064 C 116.848 41.792 118.128 41.472 119.856 39.872 C 121.52 38.336 121.84 37.12 120.24 35.52 C 118.128 33.472 115.376 31.232 112.496 28.928 Z M 277.36 36.288 L 277.36 40.576 L 277.36 44.864 C 274.48 47.552 271.984 49.024 268.912 49.024 C 265.776 49.024 263.408 47.616 263.408 44.096 C 263.408 42.112 264.304 40.512 266.48 39.168 C 268.656 37.888 272.176 36.864 277.36 36.288 Z M 235.504 10.368 C 234.672 12.16 233.712 13.952 232.816 15.552 C 231.792 17.408 232.368 18.432 234.352 19.2 C 235.888 19.776 236.976 19.52 237.872 18.176 C 238.896 16.512 240.048 14.656 241.136 12.672 C 242.096 10.944 242.992 9.152 243.888 7.424 C 245.04 5.184 244.464 3.84 242.096 3.072 C 239.984 2.432 238.704 3.008 237.872 5.056 C 237.232 6.784 236.4 8.576 235.504 10.368 Z M 206.64 10.048 C 205.616 8.192 204.4 6.272 203.184 4.544 C 202.224 3.264 201.008 3.008 199.536 3.584 C 197.424 4.416 196.976 5.76 198.256 7.616 C 199.216 9.152 200.112 10.816 201.008 12.416 C 201.84 13.952 202.544 15.424 203.12 16.832 C 203.888 18.944 205.168 19.264 207.216 18.368 C 209.072 17.6 209.712 16.512 209.008 14.656 C 208.368 13.248 207.536 11.648 206.64 10.048 Z M 182.512 45.696 C 181.552 44.16 180.592 42.56 179.632 41.088 C 178.672 39.616 177.456 39.36 175.856 40.064 C 173.936 40.96 173.488 42.176 174.576 43.968 C 175.408 45.44 176.304 46.912 177.136 48.384 C 177.904 49.728 178.608 51.008 179.248 52.16 C 180.144 54.016 181.424 54.208 183.28 53.248 C 185.072 52.352 185.712 51.264 184.816 49.472 C 184.112 48.256 183.344 46.976 182.512 45.696 Z M 169.904 22.72 L 162.928 22.72 L 162.928 17.728 L 169.904 17.728 L 176.944 17.728 L 176.944 22.72 L 169.904 22.72 Z M 130.992 46.976 C 130.416 48.192 129.84 49.472 129.264 50.56 C 128.112 52.416 128.624 53.696 130.544 54.72 C 132.144 55.552 133.36 55.36 134.32 53.824 C 135.024 52.416 135.664 50.944 136.24 49.344 C 136.88 47.744 137.456 46.144 137.968 44.544 C 138.48 42.88 137.84 41.856 136.24 41.216 C 134.384 40.448 133.168 40.96 132.528 42.88 C 132.08 44.224 131.568 45.632 130.992 46.976 Z M 169.904 32.384 L 164.848 32.384 C 163.568 32.384 162.928 31.744 162.928 30.464 L 162.928 27.328 L 169.904 27.328 L 176.944 27.328 L 176.944 30.464 C 176.944 31.744 176.304 32.384 175.024 32.384 L 169.904 32.384 Z M 169.904 13.12 L 162.928 13.12 L 162.928 10.112 C 162.928 8.832 163.568 8.192 164.848 8.192 L 169.904 8.192 L 175.024 8.192 C 176.304 8.192 176.944 8.832 176.944 10.112 L 176.944 13.12 L 169.904 13.12 Z M 51.824 6.976 C 50.544 5.696 49.2 4.352 47.92 3.2 C 46.768 2.176 45.616 2.112 44.336 3.008 C 42.544 4.224 42.416 5.504 44.016 6.976 C 45.104 8.064 46.128 9.216 47.152 10.368 C 48.048 11.392 48.944 12.352 49.648 13.248 C 50.864 15.04 52.016 15.104 53.808 13.888 C 55.408 12.736 55.728 11.648 54.576 10.048 C 53.744 9.088 52.784 8 51.824 6.976 Z M 159.984 40.704 C 158.96 39.68 157.872 38.656 156.848 37.632 C 155.696 36.672 154.544 36.736 153.392 37.632 C 151.92 38.784 151.728 40 153.072 41.344 C 153.968 42.24 154.864 43.264 155.76 44.224 C 156.592 45.12 157.36 45.952 158.064 46.72 C 159.28 48.192 160.432 48.064 161.904 46.848 C 163.312 45.632 163.632 44.608 162.416 43.2 C 161.648 42.432 160.816 41.536 159.984 40.704 Z M 295.536 11.008 C 296.368 11.776 297.52 12.224 298.864 12.224 C 300.208 12.224 301.36 11.776 302.128 11.008 C 302.96 10.24 303.408 9.088 303.408 7.744 C 303.408 5.184 301.552 3.392 298.864 3.392 C 296.112 3.392 294.256 5.184 294.256 7.744 C 294.256 9.088 294.704 10.24 295.536 11.008 Z"/>
        </svg>
    `;
    
    const path = navbarBrand.querySelector('.title-path');
    if (!path) return;
    
    // 设置路径长度
    const pathLength = path.getTotalLength();
    path.style.setProperty('--path-length', pathLength);
    
    // 如果已播放过，直接返回
    if (hasPlayed) return;
    
    // 等待下一帧再启动动画，确保 --path-length 已生效
    requestAnimationFrame(() => {
        requestAnimationFrame(() => {
            path.classList.add('playing');
            
            // 动画结束后标记
            setTimeout(() => {
                path.classList.remove('playing');
                path.classList.add('completed');
                sessionStorage.setItem(SESSION_KEY, 'true');
            }, STROKE_DURATION);
        });
    });
});
