// 博客标题 SVG 描边动画 - "我不想当ai"
// JS 只负责：插入 SVG、设置路径长度、检测是否跳过动画
// 动画由 CSS 自动控制，无需等待

document.addEventListener('DOMContentLoaded', function() {
    const navbarBrand = document.querySelector('.navbar-brand');
    
    if (!navbarBrand) return;
    if (navbarBrand.querySelector('.title-svg')) return;
    
    // 配置
    const STROKE_DURATION = 4000;
    const SESSION_KEY = 'titleAnimationPlayed';
    
    // 检查是否已播放过
    const hasPlayed = sessionStorage.getItem(SESSION_KEY);
    
    // 插入 SVG
    navbarBrand.innerHTML = `
        <svg class="title-svg" viewBox="0 0 224.496 43.824" xmlns="http://www.w3.org/2000/svg" aria-label="我不想当ai" role="img">
            <path class="title-path${hasPlayed ? ' no-animation' : ''}" d="M 22.176 22.464 L 22.176 25.104 Q 17.808 26.592 12.96 27.84 L 12.96 38.88 Q 12.96 43.056 8.976 43.056 L 3.696 43.056 L 3.12 40.608 Q 5.712 40.752 8.064 40.752 Q 10.368 40.752 10.368 38.208 L 10.368 28.464 Q 5.904 29.472 0.384 30.384 L 0 27.84 Q 5.472 26.976 10.368 25.824 L 10.368 15.792 L 0.096 15.792 L 0.096 13.296 L 10.368 13.296 L 10.368 5.76 Q 6.288 6.624 1.968 7.2 L 1.44 4.704 Q 11.712 3.552 19.728 0.432 L 20.64 2.88 Q 16.992 4.176 12.96 5.184 L 12.96 13.296 L 25.536 13.296 Q 25.056 7.584 25.056 0 L 27.648 0 Q 27.648 7.536 28.08 13.296 L 43.2 13.296 L 43.2 15.792 L 28.272 15.792 Q 28.8 21.36 29.712 25.056 Q 30.24 27.216 30.864 29.088 Q 34.704 24.624 37.488 18.864 L 39.744 20.064 Q 36.432 26.976 31.824 31.824 Q 32.832 34.464 34.224 36.624 Q 36.672 40.224 38.256 40.224 Q 39.984 40.128 41.232 31.632 L 43.536 32.88 Q 41.808 43.008 38.64 43.008 Q 35.856 43.008 32.592 38.64 Q 31.104 36.528 29.856 33.744 Q 24.528 38.688 17.664 41.376 L 16.224 39.168 Q 23.472 36.432 28.848 31.152 Q 27.936 28.656 27.216 25.584 Q 26.256 21.552 25.728 15.792 L 12.96 15.792 L 12.96 25.2 Q 17.856 23.904 22.176 22.464 Z M 147.696 18.384 L 147.696 15.84 L 164.4 15.84 L 164.4 0.384 L 167.088 0.384 L 167.088 15.84 L 183.36 15.84 L 183.36 43.392 L 180.768 43.392 L 180.768 41.328 L 147.264 41.328 L 147.264 38.784 L 180.768 38.784 L 180.768 29.568 L 149.904 29.568 L 149.904 27.12 L 180.768 27.12 L 180.768 18.384 L 147.696 18.384 Z M 49.488 5.232 L 49.488 2.688 L 89.808 2.688 L 89.808 5.232 L 74.112 5.232 Q 72.816 8.256 70.992 11.28 L 70.992 43.824 L 68.304 43.824 L 68.304 15.216 Q 61.536 24.192 49.872 31.152 L 48.144 28.944 Q 64.896 19.2 71.232 5.232 L 49.488 5.232 Z M 107.52 13.488 L 107.52 26.16 L 104.928 26.16 L 104.928 12.096 Q 101.712 18.576 96.48 23.904 L 95.52 21.408 Q 101.472 15.936 104.784 8.544 L 96.624 8.544 L 96.624 6.048 L 104.928 6.048 L 104.928 0.528 L 107.52 0.528 L 107.52 6.048 L 114.192 6.048 L 114.192 8.544 L 107.52 8.544 L 107.52 11.184 Q 111.312 13.968 115.392 17.712 L 113.904 19.872 Q 110.16 15.84 107.52 13.488 Z M 213.12 23.04 L 213.12 39.024 L 210.384 39.024 L 210.384 34.272 Q 208.848 36.48 206.352 37.968 Q 203.424 39.696 199.872 39.696 Q 196.224 39.696 193.968 37.824 Q 191.712 35.904 191.712 32.688 Q 191.712 27.936 195.6 25.776 Q 198.72 24 203.904 24 L 210.24 23.952 L 210.24 23.04 Q 210.24 15.984 203.04 15.984 Q 199.728 15.984 197.856 17.376 Q 195.744 18.768 195.312 21.696 L 192.48 21.696 Q 193.056 17.52 195.984 15.456 Q 198.672 13.536 203.184 13.536 Q 208.416 13.536 210.912 16.368 Q 213.12 18.816 213.12 23.04 Z M 117.792 25.152 L 117.792 2.064 L 135.36 2.064 L 135.36 25.152 L 117.792 25.152 Z M 123.792 42.672 L 111.984 42.672 Q 107.856 42.672 107.856 38.352 L 107.856 28.416 L 110.448 28.416 L 110.448 37.824 Q 110.448 40.128 112.8 40.128 L 123.312 40.128 Q 125.28 40.128 126 39.408 Q 127.056 38.304 127.392 33.456 L 129.84 34.272 Q 129.408 40.176 127.872 41.568 Q 126.624 42.672 123.792 42.672 Z M 220.608 39.024 L 220.608 14.208 L 223.488 14.208 L 223.488 39.024 L 220.608 39.024 Z M 75.168 17.232 L 76.992 15.408 Q 85.392 22.08 91.152 28.848 L 89.136 30.864 Q 84.048 24.528 75.168 17.232 Z M 210.24 29.184 L 210.24 26.304 L 204.048 26.352 Q 194.64 26.4 194.64 32.64 Q 194.64 34.704 196.224 36 Q 197.76 37.296 200.448 37.296 Q 204.336 37.296 207.36 34.704 Q 210.24 32.16 210.24 29.184 Z M 120.336 22.848 L 132.816 22.848 L 132.816 18.096 L 120.336 18.096 L 120.336 22.848 Z M 120.336 4.464 L 120.336 9.168 L 132.816 9.168 L 132.816 4.464 L 120.336 4.464 Z M 120.336 11.376 L 120.336 15.888 L 132.816 15.888 L 132.816 11.376 L 120.336 11.376 Z M 129.888 29.232 L 132 27.936 Q 136.8 33.984 139.44 38.784 L 137.28 40.32 Q 134.496 35.184 129.888 29.232 Z M 101.28 29.088 L 103.824 29.664 Q 102 36.384 98.448 41.568 L 96.192 40.128 Q 99.744 35.088 101.28 29.088 Z M 181.2 2.4 L 183.6 3.504 Q 181.104 8.784 177.312 13.44 L 174.96 12.192 Q 178.944 7.152 181.2 2.4 Z M 31.152 2.304 L 32.928 0.624 Q 38.112 4.128 41.712 7.824 L 39.888 9.648 Q 36.672 6.24 31.152 2.304 Z M 148.272 4.272 L 150.48 2.928 Q 154.704 8.16 156.816 11.904 L 154.608 13.44 Q 152.4 9.408 148.272 4.272 Z M 114.912 28.896 L 116.976 27.6 Q 120.672 31.488 122.544 34.224 L 120.432 35.712 Q 118.608 32.88 114.912 28.896 Z M 222.048 5.28 Q 223.056 5.28 223.776 6 Q 224.496 6.576 224.496 7.68 Q 224.496 8.64 223.728 9.408 Q 222.96 10.08 222.048 10.08 Q 220.992 10.08 220.32 9.408 Q 219.6 8.688 219.6 7.68 Q 219.6 6.576 220.32 6 Q 220.992 5.28 222.048 5.28 Z"/>
        </svg>
    `;
    
    const path = navbarBrand.querySelector('.title-path');
    if (!path) return;
    
    // 设置路径长度（CSS 动画需要这个变量）
    const pathLength = path.getTotalLength();
    path.style.setProperty('--path-length', pathLength);
    
    // 如果是首次播放，动画结束后标记并添加 completed 类
    if (!hasPlayed) {
        setTimeout(() => {
            path.classList.add('completed');
            sessionStorage.setItem(SESSION_KEY, 'true');
        }, STROKE_DURATION);
    }
});
